
## useState


```typescript
// state state変数
// setState state変数を更新する関数
// initialState state変数の初期値
const [state, setState] = useState(initialState)

const [age, setAge] = useState<number>(28);
const [name, setName] = useState<string>('Taylor');

// 初期化関数 state変数の初期値を返すための関数
const [todos, setTodos] = useState<TODO[]>(() => createTodos());

function handleClick() {
	// stateを更新する
	setState(100);
}
```


## [state はスナップショットである](https://ja.react.dev/learn/state-as-a-snapshot)（[https://ja.react.dev/reference/react/useState#updating-state-based-on-the-previous-state](https://ja.react.dev/reference/react/useState#updating-state-based-on-the-previous-state)）

- stateを何度セットしても、実際に更新されるのは次回のレンダー時のみ。

	```typescript
	// age=42の例
	// 何度setAgeしても結果は43になる
	function handleClick() {
	  setAge(age + 1); // setAge(42 + 1)
	  setAge(age + 1); // setAge(42 + 1)
	  setAge(age + 1); // setAge(42 + 1)
	}
	```

- もし45にしたい場合は更新用関数をsetAgeに渡す

	```typescript
	// 更新用関数は処理中のstateの値を受け取り、そこから次のstateを導出する
	function handleClick() {
	  setAge(a => a + 1); // setAge(42 => 43)
	  setAge(a => a + 1); // setAge(43 => 44)
	  setAge(a => a + 1); // setAge(44 => 45)
	}
	```

- 全体像

	```typescript
	import { useState } from 'react';
	
	function App() {
	  // 43にしかならない
	  function handleClick1() {
	    setAge(age + 1);
	    setAge(age + 1);
	    setAge(age + 1);
	  }
	  
	    // 45になる
	  function handleClick2() {
	    setAge((a) => a + 1);
	    setAge((a) => a + 1);
	    setAge((a) => a + 1);
	  }
	
	  const [age, setAge] = useState<number>(42);
	  return (
	    <>
	      <p>Hello React！</p>
	      <p>age: {age}</p>
	      <button onClick={() => handleClick1()}>button</button>
	    </>
	  );
	}
	
	export default App;
	
	```


## オブジェクトや配列の state を更新する （[https://ja.react.dev/reference/react/useState#updating-objects-and-arrays-in-state](https://ja.react.dev/reference/react/useState#updating-objects-and-arrays-in-state)）


> state を更新する場合は、**既存のオブジェクトを直接**_**書き換える (mutate)**_ **のではなく、**_**置き換える (replace)**_ **必要があります**


```typescript
import { useState } from 'react';

type Profile = {
  name: string;
  age: number;
  hobby: string;
};

function App() {
  // オブジェクトごと置き換える
  function handleClick() {
    setProfile({ ...profile, age: 11 });
  }

  const [profile, setProfile] = useState<Profile>({
    name: 'Taro',
    age: 10,
    hobby: 'soccer',
  });
  return (
    <>
      <p>Hello React！</p>
      <p>name: {profile.name}</p>
      <p>age: {profile.age}</p>
      <p>hobby: {profile.hobby}</p>
      <button onClick={() => handleClick()}>button</button>
    </>
  );
}

export default App;

```


## useStateの初期値を返す関数（[https://ja.react.dev/reference/react/useState#avoiding-recreating-the-initial-state](https://ja.react.dev/reference/react/useState#avoiding-recreating-the-initial-state)）


> 関数を呼び出した結果である `createInitialTodos()` ではなく、`createInitialTodos` という_関数それ自体_を渡していることに注意してください。`useState` に関数が渡された場合、React は初期化時に、関数を一度だけ呼び出します。


関数自体を渡すことで、不要な際レンダリングを防ぐことができ、コストを少なくすることができる。


特に初期化時に重い処理や外部へのリクエストなどを不要に発生させてしまう場合は有効。


## Keyを利用したリセット（[https://ja.react.dev/reference/react/useState#resetting-state-with-a-key](https://ja.react.dev/reference/react/useState#resetting-state-with-a-key)）

- リストレンダリングでよく使われるkeyだが、例にあるようにFormに渡し、keyに設定しているstateを更新することで、Form以下のコンポーネントが再生成されるためリセットできる。
