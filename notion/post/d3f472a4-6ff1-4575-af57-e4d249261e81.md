
## useRef


> _ref_ を用いると、コンポーネントは DOM ノードやタイムアウト ID などの、[レンダーに用いない情報を保持](https://ja.react.dev/learn/referencing-values-with-refs)することができます。state と違い、ref の値を更新してもコンポーネントは再レンダーされません。ref は、React パラダイムからの「避難ハッチ」です。これらは組み込みのブラウザ API などの、React 外のシステムを取り扱うときに役立ちます。

- refはDOMノードをはじめ、さまざまな値を格納することができる
- Reactの世界とは別の世界線になる
	- レンダーを跨いで情報を保存する
	- refを更新しても再レンダーはトリガーされない
		- 出力されるコンポーネントの外見に影響しないデータを保存するのに適している

	```typescript
	import { useRef } from 'react';
	
	function MyComponent() {
	  const intervalRef = useRef(0);
	  const inputRef = useRef(null);
	  // ...
	```

- **避難ハッチ****であるため、****本当に必要な場合のみ****使用する**
	- フォーカス、スクロール、または DOM 要素の測定などの非破壊的なアクションに ref を使用する。

## 返り値

- `current`
	- 初期値は`initialValue`
	- 値の更新は可能
	- refオブジェクトをJSXノードの`ref` 属性に渡すと、JSXノードの情報を持ったオブジェクトを参照できる

	```typescript
	import { useRef } from 'react';
	
	function MyComponent() {
	  const intervalRef = useRef(0);
	  const inputRef = useRef(null);
	  // ...
	  
	  console.log(intervalRef.current) // 0
	  
	  // currentプロパティを手動で更新する
	  intervalRef.current = 100
	```


## DOMを操作する（[https://ja.react.dev/reference/react/useRef#manipulating-the-dom-with-a-ref](https://ja.react.dev/reference/react/useRef#manipulating-the-dom-with-a-ref)）

- ref属性にrefを渡す

	```typescript
	import { useRef } from 'react';
	
	function MyComponent() {
	  const inputRef = useRef(null);
	  // ...
	  
	  // refオブジェクトのcurrentには、DOMノードが設定される
	  return <input ref={inputRef} />;
	```

- `focus()`のようなメソッドを呼ぶことが可能になる

	```typescript
	  function handleClick() {
	    inputRef.current.focus();
	  }
	```


## refの再生成を防ぐ（[https://ja.react.dev/reference/react/useRef#avoiding-recreating-the-ref-contents](https://ja.react.dev/reference/react/useRef#avoiding-recreating-the-ref-contents)）

- refはレンダーされるたびに再生成される
	- refの初期化処理
	- currentがnullだった場合（初期レンダーだった場合）のみ、初期値を設定する例

	```typescript
	function Video() {
	  const playerRef = useRef(null);
	  // 通常レンダー中にref.currentの読み取りや書き込みは許容されていないが、結果が予測できる場合のみ、利用して良い。
	  if (playerRef.current === null) {
	    playerRef.current = new VideoPlayer();
	  }
	  // ...
	```


## 親コンポーネントから子の独自コンポーネントに対してrefを取得する場合（[https://ja.react.dev/reference/react/useRef#i-cant-get-a-ref-to-a-custom-component](https://ja.react.dev/reference/react/useRef#i-cant-get-a-ref-to-a-custom-component)）

- forwardRefを使用する
	- [https://ja.react.dev/reference/react/forwardRef](https://ja.react.dev/reference/react/forwardRef)

### useImperativeHandle（[https://ja.react.dev/reference/react/useImperativeHandle](https://ja.react.dev/reference/react/useImperativeHandle)）

- 親コンポーネントから子コンポーネントの内部メソッドやプロパティを直接操作するために使用される
	- 親から操作したメソッドなどを限定させたい場合に利用される

		```typescript
		import { forwardRef, useRef, useImperativeHandle } from 'react';
		
		const MyInput = forwardRef(function MyInput(props, ref) {
		  const inputRef = useRef(null);
		
			// 親コンポーネントは、focus と scrollIntoViewメソッドの2つのみ、操作することができる
		  useImperativeHandle(ref, () => {
		    return {
		      focus() {
		        inputRef.current.focus();
		      },
		      scrollIntoView() {
		        inputRef.current.scrollIntoView();
		      },
		    };
		  }, []);
		
		  return <input {...props} ref={inputRef} />;
		});
		```

