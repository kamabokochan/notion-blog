
PR: [https://github.com/kamabokochan/next13/pull/1](https://github.com/kamabokochan/next13/pull/1)


Next.js(13)å‰æ


Install


```shell
yarn add msw --dev
```


src/mocks/handlers.jsã®ä½œæˆ


ServiceWorkerã®ä½œæˆ


```shell
npx msw init ./public --save
```


browserã®å ´åˆ


```typescript
// src/mocks/browser.js
import { setupWorker } from 'msw'
import { handlers } from './handlers'

// This configures a Service Worker with the given request handlers.
export const worker = setupWorker(...handlers)
```


src/mocks/browser.jsã®ä½œæˆ


```typescript
rest.get('/test', (req, res, ctx) => {
  return res(
    ctx.status(200),
    ctx.json({
      text: 'testã§ã™',
    }),
  )
}),
```


###  ğŸ¬tips


>error Invariant Violation: [MSW] Failed to execute `setupWorker` in a non-browser environment. Consider using `setupServer` for Node.js environment instead.


â†’ Nextã®localèµ·å‹•ãŒSSRãªã®ã§ã€browserã‚’é¸æŠã—ã¦ã„ã‚‹å ´åˆã¯ã€ `use client` ãªã©ã§clientå´ã§å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚é€†ã«nodeã‚’é¸ã‚“ã§ã„ã‚‹å ´åˆã¯ã€ç‰¹ã«è¨­å®šã¯ã„ã‚‰ãªã„ã¨æ€ã‚ã‚Œã‚‹ã€‚


src/app/page.tsx


```typescript
'use client'

if (process.env.NODE_ENV === 'development') {
  const { worker } = require('../mocks/browser')
  worker.start()

	const testFetch = async () => {
    const response = await fetch(
      '/test'
    );
    const data = await response.json();
    console.log(data)
	};
  testFetch();
}
```


ä»¥ä¸‹ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°æº–å‚™OK


![ä»£æ›¿ãƒ†ã‚­ã‚¹ãƒˆ](/notion/image/0bea3087-8afb-41e8-931f-56c42cc1a17c/21b39377-5de3-40c5-83b9-39b46240921c.jpg)


serverã®å ´åˆ


src/mocks/server.js ä½œæˆ


```typescript
// src/mocks/server.js
import { setupServer } from 'msw/node'
import { handlers } from './handlers'

// This configures a request mocking server with the given request handlers.
export const server = setupServer(...handlers)
```


src/mocks/handlers.jsã«è¿½åŠ 


```typescript
// https://mswjs.io/docs/getting-started/integrate/node
// Jest ã® jsdom ã®ã‚ˆã†ãª DOM ã®ã‚ˆã†ãªç’°å¢ƒãŒãªã„å ´åˆã€NodeJS ã§çµ¶å¯¾ãƒªã‚¯ã‚¨ã‚¹ãƒˆ URL ã‚’ä½¿ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚
rest.get('https://api.backend.dev/user', (req, res, ctx) => {
  return res(ctx.json({ firstName: 'John' }))
}),
```


src/app/page.tsx

- serverã§å®Ÿè¡Œã™ã‚‹ã®ã§RSCã«ã™ã‚‹
- server.listen

```typescript
const { server } = require('../mocks/server')
  // https://mswjs.io/docs/api/setup-worker/start#onunhandledrequest
  server.listen({ onUnhandledRequest: "bypass" })
```


## å‚è€ƒ

- [https://reffect.co.jp/html/mock-service-worker#i-8](https://reffect.co.jp/html/mock-service-worker#i-8)
- [https://zenn.dev/silverbirder/articles/c3de04c9e6dd58](https://zenn.dev/silverbirder/articles/c3de04c9e6dd58)
- [https://zenn.dev/takepepe/articles/msw-data-userflow-testing](https://zenn.dev/takepepe/articles/msw-data-userflow-testing)
- [https://github.com/mswjs/data](https://github.com/mswjs/data)
- [https://mswjs.io/docs/](https://mswjs.io/docs/getting-started/integrate/node)
