- メモ
	- どの単位で（URLなのか、コンポーネントなのか）
	- 閾値
	- storybookとセットで使っているか
	- プロジェクトフェーズとしては、立ち上げと運用どちらも有用か

## 「reg-viz and VRT tools」Quramyさん（[2:12](https://www.youtube.com/watch?v=_yBl_mhOO2k&t=132s)）

- VRTはフロントエンド開発のスピードを上げるためのもの
	- 修正の影響が可視化され、安心感が受け入れの速度を保つ
	- レビュアーの確認コストも下がる
- Componentカタログ（Storybook）などで、挙動や見た目を確認しながら小さくComponent開発を進める
	- 折角Storybookを利用しているなら、VRTを導入したらいい
	- 「VRTのためにComponentカタログを用意しよう」ではない
- reg-vix tools
	- 画像を出力するツール
		- `Storycap`, `storycap-testrun`
	- 画像を比較するツール
		- `reg-suit`, `reg-actions`
- 画像で分離しているので、さまざまな組み合わせができる
	- WebアプリコンポーネントのVRT例
		- `Storybook` x `storycap-testrun` x `reg-actions`
	- WebページのVRT例
		- `Playwright(Cypress)` x `reg-suit`
- Storybook
	- 近年はテスト基盤の機能強化も
		- Play function
		- storybook/test（storybook/jest, storybook/testing-library）
- Storybook x reg-vix（画像出力）
	- Storycap
		- storybookのurlを指定したらPNG化するCLI
	- storycap-testrun
		- `storybook/test-runnner`上で利用する前提のライブラリ
- 画像比較
	- reg-cli
		- シンプルな比較
		- 閾値の設定やレポート出力機能を備える
- reg-vizの考えるワークフロー
	- CI上でVRTが完結するように設計している
	- PR上で結果と差分の詳細を通知し、レビューしてもらう
- ワークフローサポートツール
	- reg-suit
	- reg-actions

		![代替テキスト](/notion/image/4f7a3ae1-8a12-4b16-8d4d-c7032fd91abc/1028b1fc-658c-80ac-b448-fe32ae775b53.jpg)


## 「Storybookの実力をフル活用するChromaticの活用」sakitoさん（[22:04](https://www.youtube.com/watch?v=_yBl_mhOO2k&t=1324s)）

- Chromaticはstorybookのメンテナが運営している
	- storybookとの親和性が高い
- 一部無料（従量課金）
- 主な機能
	- Storybookのホスティング
	- VRTテスト
		- ブラウザ設定可能
		- ブラウザ x Story数分で課金される
- SnapShotの単位
	- Story単位
- 全体 or コンポーネント毎に、閾値などを設定できる
- Storybookのホスティングしてくれるので、共有がしやすい
- VRTの導入によって、レビューコストが下がった
	- 差分だけ見るで良くなった（破壊的変更などの影響をあまり気にしなくて良くなる）
	- DisabledやHoverなどのUIパターンの変更検知などの自動化
- Storybookを中心に運用が回るような環境に自然となる
- Storyを分けるテクニック
	- Button.stories.tsx
		- 基本パターン
	- Button.interaction.stories.tsx
		- インタラクションテスト用
	- Button.vrt.stories.tsx
		- VRT用（VRTが落ちた時以外は見ない）

		![代替テキスト](/notion/image/4f7a3ae1-8a12-4b16-8d4d-c7032fd91abc/1028b1fc-658c-8084-953d-c62d167a09aa.jpg)

- Snapshot数は、何も設定しないとgit push 毎に増加してしまう
	- TurboSnapを利用すると、変更差分があるStoryのみを対象にSnapshotを撮るようになる
		- viteは別プラグイン必要
	- **package.jsonの更新で、Snapshotが撮られるのは防げない**
- Storybook v8では、Storybook上でChromaticの確認ができるように
	- CI上の確認は不要になる

## 「VRTのダークホースLostPixelについて」aijiさん（[44:40](https://www.youtube.com/watch?v=_yBl_mhOO2k&t=2680s)）

- LostPixelとは
	- スナップショットと差分検査がLostPixel1つで実行可能
	- モードが2つ
		- OSSモード（無料）
			- githubリポジトリで管理
		- プラットフォームモード（有料）
			- 専用Webツールで管理
			- 7000ショット/月 まではフリープラン
- 推しポイント
	- 設定ファイルを動的に生成できる（lostpixel.config.ts）
		- 非エンジニアでも設定変更可能
	- Playwrightが書けるのであれば、撮影前の任意処理を設定可能
	- 閾値や待機秒数はページ・ストーリー毎に設定可能
	- ランダムなコンテンツ（広告とか）など、動きのあるコンテンツをマスキングできる
- イマイチなところ
	- ドキュメントの情報量の少なさ
	- OSSモードの差分プレビュー機能が充実していない
		- 差分画像が出力されるのみ
- 運用について
	- ビジュアル要件のために
		- 意図しないビジュアルの差異が発生していないかを検知するため
		- フォーカスやホバー、キーボード操作時などのビジュアル変化が要件を満たしているのか
	- タグ設定
		- タグ情報をURLパタメータに渡すことで、複数の状態のVRTができる
	- CIのVRT実行による差分
		- 差分
			- 意図しない差分
			- 意図しているが、ベースラインのアップデートを忘れている
				- → コードの修正を行うか、ベースラインをアップデートするかを選択
				- 特定のPRコメントにフックし、CIで自動的にベースラインのアップデートコミットを行えるようにすると便利
- 参考
	- [https://zenn.dev/aiji42/articles/6656072a954a9b](https://zenn.dev/aiji42/articles/6656072a954a9b)

## 「Playwrightで一番小さく始めるVRTと、次のステップの選択肢」Hirotaka Miyagiさん（[1:03:20](https://www.youtube.com/watch?v=_yBl_mhOO2k&t=3800s)）

- Playwrightで小さく始めるVRT
	- 撮影・比較・差分確認の全フェーズ可能
	- 撮影

		```typescript
		test("example test", async ({page}) => {
			await page.goto("http://localhost:3000")
			
			// ダークモードに切り替えてから撮影のようなカスタマイズが可能
			await page.getByRole("button", { name: "Toggle dark mode" }).click();
			
			await page.screenshot();
		})
		```

	- 比較

		```typescript
		test("example test", async ({page}) => {
			await page.goto("http://localhost:3000")
			await expect(page).toHaveScreenshot();
		})
		```

	- 差分確認
		- コマンド実行で比較アプリケーションのローカルサーバーが立ち上がる
- 小さく始めるための指針
	- Preview環境へのデプロイで発火するCIとしてVRTする
		- 本番環境のスクリーンショットと比較する
- 次のステップの選択肢
	- Storyに対してスクリーンショットを撮りたい場合
		- `storybook/test-runnner`や`storycap`などを利用
	- 差分確認を簡単にしたい
		- reg-suitなどを利用する（S3バケットなどのストレージが必要）
		- 比較・差分のみ、lost-pixelに切り替える
